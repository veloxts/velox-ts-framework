---
title: tRPC API Architecture
description: Maximum type safety with tRPC-only APIs.
---

Use this architecture when all your clients are TypeScript and you want maximum type safety.

## When to Choose tRPC

- All clients are TypeScript
- Maximum type safety is priority
- Internal APIs between services
- No need for REST/OpenAPI

## Project Setup

```bash
npx create-velox-app my-api --trpc
```

## How It Works

With `--trpc`, VeloxTS skips REST generation. You get pure tRPC:

```typescript
// src/procedures/users.ts
import { procedures, procedure } from '@veloxts/velox';
import { z } from '@veloxts/velox';

export const userProcedures = procedures('users', {
  list: procedure()
    .output(z.array(UserSchema))
    .query(({ ctx }) => ctx.db.user.findMany()),

  get: procedure()
    .input(z.object({ id: z.string() }))
    .query(({ input, ctx }) => ctx.db.user.findUniqueOrThrow({
      where: { id: input.id }
    })),

  create: procedure()
    .input(CreateUserSchema)
    .mutation(({ input, ctx }) => ctx.db.user.create({ data: input })),
});
```

## Client Usage

Use `@veloxts/client` in tRPC mode for fully typed API calls:

```typescript
// frontend/src/api.ts
import { createClient } from '@veloxts/client';
import type { AppRouter } from '../../api/src/router';

export const api = createClient<AppRouter>({
  baseUrl: 'http://localhost:3030/trpc',
  // mode: 'trpc' - auto-detected when baseUrl ends with /trpc
});

// Fully typed!
const users = await api.users.list();
const user = await api.users.get({ id: '123' });
```

The client auto-detects tRPC mode when `baseUrl` ends with `/trpc`. Queries (procedures starting with `get`, `list`, `find`) use GET with encoded input, mutations use POST with JSON body.

### React Query Integration

For React apps, use the hooks API:

```tsx
// frontend/src/lib/api.ts
import { createVeloxHooks, VeloxProvider } from '@veloxts/client/react';
import type { AppRouter } from '@/api';

export const api = createVeloxHooks<AppRouter>();

// In your app
function UserList() {
  const { data: users } = api.users.list.useQuery();
  return <ul>{users?.map(u => <li key={u.id}>{u.name}</li>)}</ul>;
}
```

See [Client Package](/docs/rsc/client-package/) for full React integration.

### Using @trpc/react-query (Advanced)

For existing codebases or specific tRPC features, use `TRPCRouter` to bridge types:

```typescript
import { createTRPCReact } from '@trpc/react-query';
import type { TRPCRouter } from '@veloxts/router';
import type { AppRouter } from '../../api/src/router';

export const trpc = createTRPCReact<TRPCRouter<AppRouter>>();
```

For most VeloxTS apps, `@veloxts/client` is recommended.

## Type Inference

Types flow automatically:

```typescript
// Backend defines the shape
const createUser = procedure()
  .input(z.object({
    name: z.string(),
    email: z.string().email(),
  }))
  .mutation(...)

// Frontend gets the types
trpc.users.create.mutate({
  name: 'Alice',  // TypeScript knows this is required
  email: 'alice@example.com',
  // @ts-error - 'age' doesn't exist
  age: 30,
});
```

## Adding REST Later

If you later need REST endpoints (for mobile apps, third parties, webhooks), add the REST adapter to your app:

```typescript
// src/index.ts
import { velox, rest } from '@veloxts/velox';
import { collections } from './router.js';

const app = await velox({ port: 3030 });

app.routes(
  rest(collections, { prefix: '/api' })  // Add this line
);
```

REST uses naming conventions to infer HTTP methods, so you may need to rename procedures:

```typescript
// Before (tRPC-style, short names)
list: procedure()...
get: procedure()...
create: procedure()...

// After (REST-style, includes resource name)
listUsers: procedure()...   // → GET /api/users
getUser: procedure()...     // → GET /api/users/:id
createUser: procedure()...  // → POST /api/users
```

See [REST Conventions](/docs/router/rest-conventions/) for the full naming guide.

## Related Content

- [Procedures](/docs/router/procedures/) - Procedure API reference
- [tRPC Adapter](/docs/router/trpc-adapter/) - tRPC configuration
- [Client Package](/docs/rsc/client-package/) - Frontend client
