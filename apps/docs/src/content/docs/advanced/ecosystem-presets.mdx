---
title: Ecosystem Presets
description: Environment-aware configuration for VeloxTS ecosystem packages.
---

Ecosystem presets provide sensible defaults for all VeloxTS ecosystem packages based on your environment. One function call configures caching, queues, mail, storage, events, and scheduling.

## Quick Start

```typescript
import { veloxApp, usePresets } from '@veloxts/velox';

const app = await veloxApp({ port: 3030 });

// Auto-configure based on NODE_ENV
await usePresets(app);

await app.start();
```

The preset system reads `NODE_ENV` and configures each ecosystem package with appropriate drivers:

- **Development**: Fast, local implementations (memory cache, sync queue, log mail)
- **Test**: Isolated, predictable behavior for testing
- **Production**: Distributed, scalable services (Redis, S3, Resend)

## Environment Defaults

| Package | Development | Test | Production |
|---------|-------------|------|------------|
| **Cache** | `memory` | `memory` | `redis` |
| **Queue** | `sync` | `sync` | `bullmq` |
| **Mail** | `log` | `log` | `resend` |
| **Storage** | `local` | `local` | `s3` |
| **Events** | `ws` | `ws` | `ws` + Redis pub/sub |
| **Scheduler** | cron | cron | cron |

### Development Preset

Optimized for fast local iteration:

```typescript
{
  cache: { driver: 'memory', config: { maxSize: 1000 } },
  queue: { driver: 'sync' },
  mail: { driver: 'log' },
  storage: { driver: 'local', root: './uploads', baseUrl: '/files' },
  events: { driver: 'ws', path: '/ws' },
  scheduler: { tasks: [] },
}
```

- No external services required (Redis, S3, SMTP)
- Fast startup and restarts
- Emails logged to console for debugging

### Test Preset

Optimized for fast, isolated tests:

```typescript
{
  cache: { driver: 'memory', config: { maxSize: 100 } },
  queue: { driver: 'sync' },
  mail: { driver: 'log' },
  storage: { driver: 'local', root: './tmp/test-uploads', baseUrl: '/files' },
  events: { driver: 'ws', path: '/ws' },
  scheduler: { tasks: [] },
}
```

- Smaller cache limits
- Temp directory for storage (easy cleanup)
- Synchronous job execution for predictable tests

### Production Preset

Optimized for scale and reliability:

```typescript
{
  cache: { driver: 'redis', config: { url: process.env.REDIS_URL } },
  queue: { driver: 'bullmq', config: { url: process.env.REDIS_URL } },
  mail: { driver: 'resend', config: { apiKey: process.env.RESEND_API_KEY } },
  storage: { driver: 's3', bucket: process.env.S3_BUCKET, region: process.env.AWS_REGION },
  events: { driver: 'ws', path: '/ws', redis: process.env.REDIS_URL },
  scheduler: { tasks: [] },
}
```

## Production Environment Variables

The production preset requires these environment variables:

| Variable | Description | Required |
|----------|-------------|----------|
| `REDIS_URL` | Redis connection URL (for cache, queue, events) | Yes |
| `RESEND_API_KEY` | Resend API key (for transactional email) | Yes |
| `S3_BUCKET` | S3 bucket name (for file storage) | Yes |
| `AWS_REGION` | AWS region (defaults to `us-east-1`) | No |

Example `.env` file:

```bash
NODE_ENV=production
REDIS_URL=redis://localhost:6379
RESEND_API_KEY=re_xxxxx
S3_BUCKET=my-app-uploads
AWS_REGION=us-east-1
```

If any required variables are missing, `usePresets()` throws a helpful error:

```
Missing required environment variables for production preset:
  - REDIS_URL: Redis connection URL (for cache, queue, events)
  - S3_BUCKET: S3 bucket name (for file storage)

Set these in your .env file or environment, or use a different preset.
```

## Customizing Presets

### Override Specific Packages

Use the `overrides` option to customize specific package configurations while keeping defaults for others:

```typescript
await usePresets(app, {
  overrides: {
    // Use SMTP instead of log driver in development
    mail: {
      driver: 'smtp',
      config: { host: 'localhost', port: 1025 },
    },
    // Increase cache size
    cache: {
      config: { maxSize: 5000 },
    },
  },
});
```

Overrides are deep-merged with the base preset, so you only need to specify what you want to change.

### Force a Specific Environment

Override the detected environment:

```typescript
// Use production drivers even in development
await usePresets(app, { env: 'production' });
```

### Selective Registration

Register only specific packages:

```typescript
// Only register cache and queue
await usePresets(app, {
  only: ['cache', 'queue'],
});
```

Exclude specific packages:

```typescript
// Register everything except scheduler
await usePresets(app, {
  except: ['scheduler'],
});
```

:::note
You cannot use `only` and `except` together. Choose one approach.
:::

### Silent Mode

Suppress console output during registration:

```typescript
await usePresets(app, { silent: true });
```

## Manual Registration

For full control, you can use the individual package plugins directly:

```typescript
import { veloxApp } from '@veloxts/velox';
import { cachePlugin } from '@veloxts/cache';
import { queuePlugin } from '@veloxts/queue';

const app = await veloxApp({ port: 3030 });

await app.register(cachePlugin({
  driver: 'redis',
  config: { url: process.env.REDIS_URL },
}));

await app.register(queuePlugin({
  driver: 'bullmq',
  config: { url: process.env.REDIS_URL },
}));

await app.start();
```

## Environment Detection

The preset system detects environments from `NODE_ENV`:

| NODE_ENV Value | Detected Environment |
|----------------|---------------------|
| `production`, `prod` | `production` |
| `test`, `testing` | `test` |
| `development`, `dev`, undefined | `development` |

Environment detection is case-insensitive and trims whitespace.

### Manual Environment Check

```typescript
import {
  detectEnvironment,
  isDevelopment,
  isProduction,
  isTest,
} from '@veloxts/velox';

const env = detectEnvironment(); // 'development' | 'test' | 'production'

if (isDevelopment()) {
  console.log('Running in development mode');
}

if (isProduction()) {
  // Enable production-only features
}
```

## API Reference

### usePresets

```typescript
function usePresets(app: VeloxApp, options?: PresetOptions): Promise<void>
```

Registers ecosystem plugins based on detected or specified environment.

**Options:**

| Option | Type | Description |
|--------|------|-------------|
| `env` | `'development' \| 'test' \| 'production'` | Override detected environment |
| `overrides` | `PresetOverrides` | Custom configuration for specific packages |
| `only` | `Array<keyof EcosystemPreset>` | Only register these packages |
| `except` | `Array<keyof EcosystemPreset>` | Exclude these packages |
| `silent` | `boolean` | Suppress console output |

### getPreset

```typescript
function getPreset(env: Environment): EcosystemPreset
```

Returns the preset configuration for an environment. For production, validates required environment variables first.

### validateProductionEnv

```typescript
function validateProductionEnv(): ProductionEnvVars
```

Validates that all required production environment variables are set. Returns the validated values or throws an error listing missing variables.

## Related Content

- [Cache Package](/docs/ecosystem/cache/) - Caching drivers and usage
- [Queue Package](/docs/ecosystem/queue/) - Background job processing
- [Mail Package](/docs/ecosystem/mail/) - Email sending
- [Storage Package](/docs/ecosystem/storage/) - File storage
- [Events Package](/docs/ecosystem/events/) - Real-time broadcasting
- [Scheduler Package](/docs/ecosystem/scheduler/) - Cron task scheduling
